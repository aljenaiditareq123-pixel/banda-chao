generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./prisma/dev.db"
}

model comment_likes {
  id         String   @id
  user_id    String
  comment_id String
  created_at DateTime @default(now())
  comments   comments @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, comment_id])
  @@index([comment_id])
  @@index([user_id])
}

model comments {
  id            String          @id
  user_id       String
  video_id      String?
  product_id    String?
  content       String
  likes         Int             @default(0)
  created_at    DateTime        @default(now())
  updated_at    DateTime
  comment_likes comment_likes[]
  products      products?       @relation(fields: [product_id], references: [id], onDelete: Cascade)
  users         users           @relation(fields: [user_id], references: [id], onDelete: Cascade)
  videos        videos?         @relation(fields: [video_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([product_id])
  @@index([user_id])
  @@index([video_id])
}

model follows {
  id                                String   @id
  follower_id                       String
  following_id                      String
  created_at                        DateTime @default(now())
  users_follows_follower_idTousers  users    @relation("follows_follower_idTousers", fields: [follower_id], references: [id], onDelete: Cascade)
  users_follows_following_idTousers users    @relation("follows_following_idTousers", fields: [following_id], references: [id], onDelete: Cascade)

  @@unique([follower_id, following_id])
  @@index([follower_id])
  @@index([following_id])
}

model group_buys {
  id        String   @id
  productId String
  status    String   @default("OPEN")
  createdAt DateTime @default(now())
  expiresAt DateTime
  products  products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([productId])
  @@index([status])
}

model makers {
  id                  String   @id
  user_id             String   @unique
  slug                String   @unique
  name                String
  bio                 String?
  story               String?
  profile_picture_url String?
  cover_picture_url   String?
  created_at          DateTime @default(now())
  updated_at          DateTime
  users               users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model messages {
  id                                String   @id
  content                           String
  sender_id                         String
  receiver_id                       String
  timestamp                         DateTime @default(now())
  read                              Boolean  @default(false)
  users_messages_receiver_idTousers users    @relation("messages_receiver_idTousers", fields: [receiver_id], references: [id], onDelete: Cascade)
  users_messages_sender_idTousers   users    @relation("messages_sender_idTousers", fields: [sender_id], references: [id], onDelete: Cascade)

  @@index([sender_id, receiver_id])
}

model notifications {
  id         String   @id
  user_id    String
  type       String
  title      String
  body       String?
  data       String?  // JSON stored as string for SQLite
  is_read    Boolean  @default(false)
  created_at DateTime @default(now())
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([is_read])
  @@index([user_id])
  @@index([user_id, is_read, created_at])
}

model order_items {
  id         String   @id
  order_id   String
  product_id String
  quantity   Int      @default(1)
  price      Float
  created_at DateTime @default(now())
  orders     orders   @relation(fields: [order_id], references: [id], onDelete: Cascade)
  products   products @relation(fields: [product_id], references: [id])

  @@index([order_id])
  @@index([product_id])
}

model orders {
  id               String        @id
  user_id          String
  status           String        @default("PENDING") // OrderStatus as String for SQLite
  totalAmount      Float
  shipping_address String?
  shipping_city    String?
  shipping_country String?
  shipping_phone   String?
  shipping_name    String?
  created_at       DateTime      @default(now())
  updated_at       DateTime
  stripe_id        String?
  order_items      order_items[]
  users            users         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([status])
  @@index([stripe_id])
  @@index([user_id])
}

model post_likes {
  id         String   @id
  user_id    String
  post_id    String
  created_at DateTime @default(now())
  posts      posts    @relation(fields: [post_id], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, post_id])
  @@index([post_id])
  @@index([user_id])
}

model posts {
  id         String       @id
  content    String
  user_id    String
  images     String?      // JSON array stored as string for SQLite
  created_at DateTime     @default(now())
  updated_at DateTime
  post_likes post_likes[]
  users      users        @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model product_likes {
  id         String   @id
  user_id    String
  product_id String
  created_at DateTime @default(now())
  products   products @relation(fields: [product_id], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, product_id])
  @@index([product_id])
  @@index([user_id])
}

model products {
  id            String          @id @default(uuid())
  name          String
  title         String?         // Alias for name, can be used as title
  description   String
  image_url     String?
  external_link String?
  video_url     String?         // Video URL for Maker Studio
  user_id       String
  price         Float?
  category      String?
  sold_count    Int             @default(0)
  created_at    DateTime        @default(now())
  updated_at    DateTime        @updatedAt
  comments      comments[]
  group_buys    group_buys[]
  order_items   order_items[]
  product_likes product_likes[]
  users         users           @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([user_id])
}

model reports {
  id          String   @id
  user_id     String
  target_id   String
  target_type String
  reason      String
  resolved    Boolean  @default(false)
  created_at  DateTime @default(now())
  users       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([resolved])
  @@index([target_id, target_type])
  @@index([user_id])
}

model users {
  id                                   String          @id @default(uuid())
  email                                String          @unique
  password                             String?         // Optional for demo user
  name                                 String?
  profile_picture                      String?
  bio                                  String?
  level                                Int             @default(1)
  points                               Int             @default(0)
  created_at                           DateTime        @default(now())
  updated_at                           DateTime        @updatedAt
  role                                 String          @default("USER") // UserRole as String for SQLite
  comment_likes                        comment_likes[]
  comments                             comments[]
  follows_follows_follower_idTousers   follows[]       @relation("follows_follower_idTousers")
  follows_follows_following_idTousers  follows[]       @relation("follows_following_idTousers")
  makers                               makers?
  messages_messages_receiver_idTousers messages[]      @relation("messages_receiver_idTousers")
  messages_messages_sender_idTousers   messages[]      @relation("messages_sender_idTousers")
  notifications                        notifications[]
  orders                               orders[]
  post_likes                           post_likes[]
  posts                                posts[]
  product_likes                        product_likes[]
  products                             products[]
  reports                              reports[]
  video_likes                          video_likes[]
  videos                               videos[]
}

model video_likes {
  id         String   @id
  user_id    String
  video_id   String
  created_at DateTime @default(now())
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  videos     videos   @relation(fields: [video_id], references: [id], onDelete: Cascade)

  @@unique([user_id, video_id])
  @@index([user_id])
  @@index([video_id])
}

model videos {
  id            String        @id
  user_id       String
  title         String
  description   String?
  video_url     String
  thumbnail_url String
  duration      Int
  type          String
  views         Int           @default(0)
  likes         Int           @default(0)
  created_at    DateTime      @default(now())
  updated_at    DateTime
  comments      comments[]
  video_likes   video_likes[]
  users         users         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([type])
  @@index([user_id])
}

model beta_applications {
  id            Int      @id @default(autoincrement())
  name          String
  email         String
  country       String
  main_platform String?
  what_you_sell String?
  preferred_lang String?
  why_join      String?
  created_at    DateTime @default(now())

  @@index([email])
  @@index([created_at])
}

// Enums converted to String type for SQLite compatibility
// OrderStatus: PENDING, PROCESSING, SHIPPED, DELIVERED, CANCELLED, PAID, FAILED
// UserRole: USER, FOUNDER, JUNDI, MECHANIC, MAKER, ADMIN, BUYER
