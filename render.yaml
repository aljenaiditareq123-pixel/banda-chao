services:
  # Frontend Service (Next.js Standalone)
  - type: web
    name: banda-chao-frontend
    env: node
    # Optimized build command for Render (uses standalone output)
    # Using npm install with --legacy-peer-deps to handle peer dependency conflicts
    # npm ci is faster but strict about peer deps, so we use npm install for compatibility
    buildCommand: npm install --legacy-peer-deps && npx prisma generate && npm run build
    # Start command uses standalone server for better performance and lower memory usage
    # Next.js standalone mode automatically copies public and static files during build
    startCommand: cd .next/standalone && node server.js
    # Node version
    nodeVersion: 20.x
    # Plan settings (adjust based on your Render plan)
    plan: starter
    # Health check
    healthCheckPath: /
    # Auto-deploy
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_FRONTEND_URL
        value: https://banda-chao-frontend.onrender.com
      - key: NEXT_PUBLIC_API_URL
        fromService:
          type: web
          name: banda-chao-backend
          property: host
        # Required for standalone mode
      - key: PORT
        value: 3000
      # NextAuth v5 - Use AUTH_SECRET and AUTH_URL (new variable names)
      - key: AUTH_URL
        value: https://banda-chao-frontend.onrender.com
      - key: AUTH_SECRET
        generateValue: true
      # Legacy support - keep old names for backward compatibility
      - key: NEXTAUTH_URL
        value: https://banda-chao-frontend.onrender.com
      - key: NEXTAUTH_SECRET
        generateValue: true
      # Database (SQLite for local, PostgreSQL for production)
      - key: DATABASE_URL
        fromDatabase:
          name: banda-chao-db
          property: connectionString

